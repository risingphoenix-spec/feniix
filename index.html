<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <link rel="shortcut icon" href="icons/icon.ico" type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#6C63FF" />
  <meta name="robots" content="index, follow">
  <meta property="og:image" content="/og.jpg"/>
  <meta name="description"
    content="Discover and stream your favorite movies and TV shows with Phoenix - a modern, open source content search and watch website. Enjoy unlimited access to a vast library of content for free.">
  <title>Phoenix</title>
  <link rel="stylesheet" href="style.min.css">
  <link rel="stylesheet" href="center-atom.min.css">
  <link rel="stylesheet" href="phoenix-redesign.css">
  <style>
    body {
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
      color: #ffffff;
      font-family: 'Inter', 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
      line-height: 1.5;
    }
    .phoenix-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 4%;
      height: 72px;
      background: rgba(15, 15, 35, 0.95);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .phoenix-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.8rem;
      font-weight: 900;
      letter-spacing: -0.5px;
      color: #E50914;
    }
    .phoenix-logo img {
      height: 32px;
      width: 32px;
      border-radius: 4px;
    }
    .phoenix-nav {
      display: flex;
      align-items: center;
      gap: 2rem;
    }
    .nav-item {
      color: #ffffff;
      text-decoration: none;
      font-size: 15px;
      font-weight: 500;
      padding: 8px 16px;
      border-radius: 8px;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    .nav-item:hover, .nav-item.active {
      background: rgba(124, 58, 237, 0.2);
      color: #a78bfa;
    }
    .phoenix-main {
      max-width: 1400px;
      margin: 0 auto;
      padding: 96px 4% 40px 4%;
    }
    .nav-content {
      display: none;
    }
    .nav-content.active {
      display: block;
    }
    .phoenix-hero {
      text-align: center;
      margin-bottom: 48px;
      padding: 60px 0 40px 0;
    }
    .phoenix-hero h1 {
      font-size: 3.2rem;
      font-weight: 700;
      margin: 0 0 16px 0;
      color: #ffffff;
    }
    .phoenix-gradient {
      color: #E50914;
    }
    .phoenix-tagline {
      font-size: 1.4rem;
      color: #ffffff;
      margin: 0 0 32px 0;
      font-weight: 400;
      opacity: 0.8;
    }
    .phoenix-search-container {
      display: flex;
      justify-content: center;
      gap: 0;
      max-width: 700px;
      margin: 0 auto;
      position: relative;
    }
    #search-input {
      width: 100%;
      padding: 18px 24px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-right: none;
      border-radius: 12px 0 0 12px;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.05);
      color: #ffffff;
      outline: none;
      transition: all 0.3s ease;
    }
    #search-input:focus {
      border-color: #a78bfa;
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.1);
    }
    #search-input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
    #search-button {
      padding: 18px 32px;
      border: 2px solid #7c3aed;
      border-radius: 0 12px 12px 0;
      background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%);
      color: #ffffff;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.3s ease;
    }
    #search-button:hover {
      background: linear-gradient(135deg, #6d28d9 0%, #8b5cf6 100%);
      transform: translateY(-1px);
      box-shadow: 0 8px 25px rgba(124, 58, 237, 0.3);
    }
    .phoenix-video-section {
      margin: 48px 0 32px 0;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 16px;
      padding: 32px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }
    .player-container {
      position: relative;
      background: #000;
      border-radius: 12px;
      overflow: hidden;
    }
    .player-controls {
      position: absolute;
      top: 8px;
      right: 8px;
      display: flex;
      gap: 4px;
      z-index: 10;
    }
    .simple-btn {
      padding: 4px 8px;
      border: none;
      border-radius: 4px;
      background: rgba(0, 0, 0, 0.7);
      color: #ffffff;
      cursor: pointer;
      font-size: 11px;
      font-weight: 500;
      transition: all 0.15s ease;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .simple-btn:hover {
      background: rgba(0, 0, 0, 0.9);
      border-color: rgba(255, 255, 255, 0.2);
    }
    .simple-btn:active {
      transform: scale(0.95);
    }
    .simple-btn.active {
      background: rgba(124, 58, 237, 0.8);
      border-color: rgba(124, 58, 237, 0.5);
    }
    .download-modal {
      position: absolute;
      top: 40px;
      right: 8px;
      background: rgba(0, 0, 0, 0.95);
      border-radius: 8px;
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      z-index: 20;
      min-width: 200px;
    }
    .download-content h3 {
      margin: 0 0 12px 0;
      color: #ffffff;
      font-size: 14px;
      font-weight: 600;
    }
    .quality-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 12px;
    }
    .quality-btn {
      padding: 8px 12px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      background: rgba(255, 255, 255, 0.1);
      color: #ffffff;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s ease;
    }
    .quality-btn:hover {
      background: rgba(124, 58, 237, 0.6);
      border-color: rgba(124, 58, 237, 0.8);
    }
    .close-btn {
      width: 100%;
      padding: 8px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      background: rgba(255, 255, 255, 0.1);
      color: #ffffff;
      cursor: pointer;
      font-size: 12px;
    }
    .close-btn:hover {
      background: rgba(239, 68, 68, 0.6);
    }
    .video {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }
    .phoenix-info {
      color: #cccccc;
      font-size: 14px;
      margin-top: 8px;
      text-align: center;
      font-weight: 400;
    }
    .phoenix-results {
      margin: 32px 0;
      min-height: 120px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 16px;
      padding: 24px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }
    .phoenix-info-section {
      margin: 48px 0 24px 0;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 16px;
      padding: 48px 32px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      text-align: center;
    }
    .history-section {
      margin: 48px 0 24px 0;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 16px;
      padding: 32px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }
    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    .history-header h2 {
      color: #ffffff;
      margin: 0;
      font-size: 1.8rem;
      font-weight: 600;
    }
    .clear-history {
      background: rgba(239, 68, 68, 0.2);
      color: #f87171;
      border: 1px solid rgba(239, 68, 68, 0.3);
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s ease;
    }
    .clear-history:hover {
      background: rgba(239, 68, 68, 0.3);
    }
    .history-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
    }
    .history-item {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .history-item:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateY(-2px);
    }
    .history-item h4 {
      margin: 0 0 8px 0;
      color: #ffffff;
      font-size: 16px;
      font-weight: 600;
    }
    .history-item p {
      margin: 0;
      color: rgba(255, 255, 255, 0.6);
      font-size: 14px;
    }
    .empty-history {
      text-align: center;
      color: rgba(255, 255, 255, 0.5);
      font-size: 16px;
      padding: 40px 20px;
    }
    .phoenix-info-section h2 {
      color: #ffffff;
      margin: 0 0 16px 0;
      font-size: 2.4rem;
      font-weight: 700;
    }
    .phoenix-info-section > p {
      font-size: 1.2rem;
      color: #cccccc;
      margin-bottom: 40px;
      font-weight: 400;
    }
    .phoenix-features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      margin-top: 32px;
    }
    .feature-card {
      background: rgba(255, 255, 255, 0.05);
      padding: 32px 24px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
      transition: all 0.3s ease;
    }
    .feature-card:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateY(-4px);
    }
    .feature-card h3 {
      color: #a78bfa;
      margin: 0 0 12px 0;
      font-size: 1.4rem;
      font-weight: 600;
    }
    .feature-card p {
      color: #cccccc;
      margin: 0;
      font-size: 1rem;
      font-weight: 400;
    }
    .phoenix-footer {
      text-align: center;
      padding: 48px 0 32px 0;
      color: #999999;
      font-size: 14px;
      background: none;
      border-top: 1px solid #333333;
      margin-top: 48px;
    }
    @media (max-width: 768px) {
      .phoenix-main {
        padding: 96px 4% 40px 4%;
      }
      .phoenix-header {
        padding: 0 4%;
        height: 64px;
      }
      .phoenix-logo {
        font-size: 1.5rem;
      }
      .phoenix-nav {
        gap: 1rem;
      }
      .nav-item {
        font-size: 14px;
        padding: 6px 12px;
      }
      .phoenix-hero h1 {
        font-size: 2.4rem;
      }
      .phoenix-tagline {
        font-size: 1.2rem;
      }
      .phoenix-search-container {
        flex-direction: column;
        gap: 0;
      }
      #search-input {
        border-radius: 12px 12px 0 0;
        border-right: 2px solid rgba(255, 255, 255, 0.1);
      }
      #search-button {
        border-radius: 0 0 12px 12px;
      }
      .phoenix-hero, .phoenix-info-section, .phoenix-video-section, .phoenix-results, .history-section {
        padding: 24px 16px;
      }
      .phoenix-features, .history-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      .phoenix-info-section h2 {
        font-size: 2rem;
      }
      .phoenix-info-section {
        padding: 32px 16px;
      }
      .history-header {
        flex-direction: column;
        gap: 16px;
        align-items: flex-start;
      }
    }
  </style>
  <!-- Serviceworker code for PWA  -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js').then(function(registration) {
          console.log('Service worker registered: ', registration.scope);
        }).catch(function(error) {
          console.log('Service worker registration failed: ', error);
        });
      });
    }
  </script>
</head>

<body>
  <header class="phoenix-header">
    <div class="phoenix-logo">
      <img src="cinema-movie-logo-with-gradient-background-template_502990-937.avif" alt="Phoenix Logo" height="56">
      <span>Phoenix</span>
    </div>
    <nav class="phoenix-nav">
      <div class="nav-item active" onclick="showTab('home')">Home</div>
      <div class="nav-item" onclick="showTab('movies')">Movies</div>
      <div class="nav-item" onclick="showTab('tv')">TV Shows</div>
      <div class="nav-item" onclick="showTab('trending')">Trending</div>
      <div class="nav-item" onclick="showTab('history')">History</div>
    </nav>
  </header>
  <main class="phoenix-main">
    <div id="home-content" class="nav-content active">
      <section class="phoenix-hero">
        <h1>Welcome to <span class="phoenix-gradient">Phoenix</span></h1>
        <h2 class="phoenix-tagline">Stream. Search. Rise Above.</h2>
        <form class="phoenix-search-container" onsubmit="event.preventDefault(); document.getElementById('search-button').click();">
          <input type="search" id="search-input" placeholder="Search any Movie, Webseries, or Anime" autocomplete="off">
          <button id="search-button" type="button">Search</button>
        </form>
      </section>
      <section class="phoenix-video-section">
        <div id="video" class="video">
          <div class="player-container">
            <iframe id="iframe" scrolling="no" src="" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen style="width:100%;min-height:340px;border-radius:12px;"></iframe>
            <div class="player-controls">
              <button class="simple-btn server-btn" onclick="switchServer()" title="Switch Server">
                Server
              </button>
              <button class="simple-btn lang-btn" onclick="switchLanguage()" title="Language">
                EN
              </button>
              <button class="simple-btn download-btn" onclick="showDownloadOptions()" title="Download">
                â¬‡
              </button>
              <button class="simple-btn refresh-btn" onclick="refreshPlayer()" title="Refresh">
                â†»
              </button>
              <button class="simple-btn fullscreen-btn" onclick="toggleFullscreen()" title="Fullscreen">
                â›¶
              </button>
            </div>
            <div id="download-modal" class="download-modal" style="display: none;">
              <div class="download-content">
                <h3>Download Options</h3>
                <div class="quality-options">
                  <button class="quality-btn" onclick="downloadVideo('720p')">720p HD</button>
                  <button class="quality-btn" onclick="downloadVideo('480p')">480p SD</button>
                  <button class="quality-btn" onclick="downloadVideo('360p')">360p</button>
                  <button class="quality-btn" onclick="downloadVideo('1080p')">1080p FHD</button>
                </div>
                <button class="close-btn" onclick="hideDownloadOptions()">Close</button>
              </div>
            </div>
          </div>
          <p class="phoenix-info">Use the controls above to switch servers, change language, download, or go fullscreen. Click directly on the video player for pause/play controls. If you experience issues, try refreshing or switching servers.</p>
          <div id="webSeriesData"></div>
        </div>
      </section>
      <section id="results" class="phoenix-results"></section>
      <section class="phoenix-info-section">
        <h2>About Phoenix</h2>
        <p>Your ultimate destination for movies and TV shows. Fast, free, and built for entertainment lovers.</p>
        <div class="phoenix-features">
          <div class="feature-card">
            <h3>ðŸŽ¬ Vast Library</h3>
            <p>Access thousands of movies and shows</p>
          </div>
          <div class="feature-card">
            <h3>âš¡ Lightning Fast</h3>
            <p>Instant search and smooth streaming</p>
          </div>
          <div class="feature-card">
            <h3>ðŸ†“ Completely Free</h3>
            <p>No subscriptions, no hidden fees</p>
          </div>
        </div>
      </section>
    </div>

    <div id="movies-content" class="nav-content">
      <section class="content-section">
        <h2>Popular Movies</h2>
        <div class="search-container">
          <input type="search" id="movies-search" placeholder="Search movies..." class="page-search">
          <button onclick="searchMovies()" class="search-btn">Search</button>
        </div>
        <div id="movies-results" class="content-grid"></div>
      </section>
    </div>

    <div id="tv-content" class="nav-content">
      <section class="content-section">
        <h2>Popular TV Shows</h2>
        <div class="search-container">
          <input type="search" id="tv-search" placeholder="Search TV shows..." class="page-search">
          <button onclick="searchTVShows()" class="search-btn">Search</button>
        </div>
        <div id="tv-results" class="content-grid"></div>
      </section>
    </div>

    <div id="trending-content" class="nav-content">
      <section class="content-section">
        <h2>Trending Now</h2>
        <div class="trending-tabs">
          <button class="trend-tab active" onclick="loadTrending('movie')">Movies</button>
          <button class="trend-tab" onclick="loadTrending('tv')">TV Shows</button>
        </div>
        <div id="trending-results" class="content-grid"></div>
      </section>
    </div>

    <div id="history-content" class="nav-content">
      <section class="history-section">
        <div class="history-header">
          <h2>Watch History</h2>
          <button class="clear-history" onclick="clearHistory()">Clear All</button>
        </div>
        <div id="history-grid" class="history-grid">
          <div class="empty-history">
            <p>No watch history yet. Start watching something to see it here!</p>
          </div>
        </div>
      </section>
    </div>
  </main>
  <footer class="phoenix-footer">
    <span>&copy; 2025 Phoenix. All rights reserved.</span>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/pace-js@latest/pace.min.js"></script>
  <script src="script.min.js"></script>
  <script>
    // Navigation functionality
    function showTab(tabName) {
      // Hide all content
      document.querySelectorAll('.nav-content').forEach(content => {
        content.classList.remove('active');
      });

      // Remove active class from all nav items
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });

      // Show selected content
      document.getElementById(tabName + '-content').classList.add('active');

      // Add active class to clicked nav item
      event.target.classList.add('active');

      // Load history if history tab is clicked
      if (tabName === 'history') {
        loadHistory();
      }
    }

    // History functionality
    function saveToHistory(title, imdb, type, season, episode) {
      let history = JSON.parse(localStorage.getItem('phoenixHistory') || '[]');

      const historyItem = {
        title: title,
        imdb: imdb,
        type: type,
        season: season,
        episode: episode,
        timestamp: new Date().toISOString(),
        watchedAt: new Date().toLocaleDateString()
      };

      // Remove duplicate if exists
      history = history.filter(item => item.imdb !== imdb || (item.season !== season || item.episode !== episode));

      // Add to beginning of array
      history.unshift(historyItem);

      // Keep only last 50 items
      history = history.slice(0, 50);

      localStorage.setItem('phoenixHistory', JSON.stringify(history));
    }

    function loadHistory() {
      const history = JSON.parse(localStorage.getItem('phoenixHistory') || '[]');
      const historyGrid = document.getElementById('history-grid');

      if (history.length === 0) {
        historyGrid.innerHTML = '<div class="empty-history"><p>No watch history yet. Start watching something to see it here!</p></div>';
        return;
      }

      historyGrid.innerHTML = '';

      history.forEach(item => {
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        historyItem.onclick = () => playFromHistory(item);

        let displayTitle = item.title;
        if (item.season && item.episode) {
          displayTitle += ` S${item.season}E${item.episode}`;
        }

        historyItem.innerHTML = `
          <h4>${displayTitle}</h4>
          <p>Watched on ${item.watchedAt}</p>
        `;

        historyGrid.appendChild(historyItem);
      });
    }

    function playFromHistory(item) {
      // Switch to home tab
      showTab('home');

      // Create URL parameters
      let url = `imdb=${item.imdb}`;
      if (item.type) url += `&type=${item.type}`;
      if (item.season) url += `&season=${item.season}`;
      if (item.episode) url += `&episode=${item.episode}`;
      url += `&title=${item.title.replace(/ /g, '_')}`;

      // Update browser URL
      window.history.replaceState({}, '', `?${url}`);

      // Trigger the existing functionality
      fillSearchInput();
    }

    function clearHistory() {
      if (confirm('Are you sure you want to clear all watch history?')) {
        localStorage.removeItem('phoenixHistory');
        loadHistory();
      }
    }

    // Player control functions
    let currentServer = 'server1'; // 'server1', 'server2', 'server3'
    let currentLanguage = 'EN'; // 'EN', 'ES', 'FR', 'DE'
    let currentVideoData = null;
    let servers = ['VidSrc', '2Embed', 'SuperEmbed'];
    let languages = ['EN', 'ES', 'FR', 'DE'];

    function switchServer() {
      // Check both local and global currentVideoData
      const videoData = currentVideoData || window.currentVideoData;
      if (!videoData) {
        alert('Please select a movie or show first');
        return;
      }

      // Cycle through servers
      let serverIndex = servers.findIndex(s => document.querySelector('.server-btn').textContent === s);
      serverIndex = (serverIndex + 1) % servers.length;

      const iframe = document.getElementById('iframe');
      const serverBtn = document.querySelector('.server-btn');

      serverBtn.textContent = servers[serverIndex];

      // Switch between different embed sources
      switch(serverIndex) {
        case 0: // VidSrc
          iframe.src = videoData.vidsrcUrl;
          break;
        case 1: // 2Embed
          iframe.src = videoData.embedUrl;
          break;
        case 2: // SuperEmbed (alternative)
          iframe.src = videoData.vidsrcUrl.replace('vidsrc.su', 'vidsrc.me');
          break;
      }

      // Visual feedback
      serverBtn.classList.add('active');
      setTimeout(() => {
        serverBtn.classList.remove('active');
      }, 500);
    }

    function switchLanguage() {
      // Check both local and global currentVideoData
      const videoData = currentVideoData || window.currentVideoData;
      if (!videoData) {
        alert('Please select a movie or show first');
        return;
      }

      let langIndex = languages.indexOf(currentLanguage);
      langIndex = (langIndex + 1) % languages.length;
      currentLanguage = languages[langIndex];

      const langBtn = document.querySelector('.lang-btn');
      langBtn.textContent = currentLanguage;

      // Get current server and rebuild URL with language
      const iframe = document.getElementById('iframe');
      let newSrc = '';

      if (iframe.src.includes('vidsrc')) {
        // For VidSrc, add language parameter
        newSrc = videoData.vidsrcUrl;
        if (newSrc.includes('?')) {
          newSrc += `&lang=${currentLanguage.toLowerCase()}`;
        } else {
          newSrc += `?lang=${currentLanguage.toLowerCase()}`;
        }
      } else if (iframe.src.includes('2embed')) {
        // For 2Embed, use different language parameter
        newSrc = videoData.embedUrl;
        if (newSrc.includes('?')) {
          newSrc += `&audio=${currentLanguage.toLowerCase()}`;
        } else {
          newSrc += `?audio=${currentLanguage.toLowerCase()}`;
        }
      } else {
        // Fallback - just add language parameter
        newSrc = iframe.src;
        if (newSrc.includes('?')) {
          if (newSrc.includes('lang=') || newSrc.includes('audio=')) {
            newSrc = newSrc.replace(/(lang|audio)=[^&]*/, `lang=${currentLanguage.toLowerCase()}`);
          } else {
            newSrc += `&lang=${currentLanguage.toLowerCase()}`;
          }
        } else {
          newSrc += `?lang=${currentLanguage.toLowerCase()}`;
        }
      }

      iframe.src = newSrc;

      // Visual feedback
      langBtn.classList.add('active');
      setTimeout(() => {
        langBtn.classList.remove('active');
      }, 500);
    }

    function showDownloadOptions() {
      // Check both local and global currentVideoData
      const videoData = currentVideoData || window.currentVideoData;
      if (!videoData) {
        alert('Please select a movie or show first');
        return;
      }

      const modal = document.getElementById('download-modal');
      modal.style.display = modal.style.display === 'none' ? 'block' : 'none';

      // Visual feedback
      const downloadBtn = document.querySelector('.download-btn');
      downloadBtn.classList.add('active');
      setTimeout(() => {
        downloadBtn.classList.remove('active');
      }, 500);
    }

    function hideDownloadOptions() {
      document.getElementById('download-modal').style.display = 'none';
    }

    function downloadVideo(quality) {
      // Check both local and global currentVideoData
      const videoData = currentVideoData || window.currentVideoData;
      if (!videoData) {
        alert('Please select a movie or show first');
        return;
      }

      // Get current video information
      const searchParams = new URLSearchParams(window.location.search);
      const imdb = searchParams.get('imdb');
      const title = searchParams.get('title') || 'video';
      const season = searchParams.get('season');
      const episode = searchParams.get('episode');

      // Create download URLs for different qualities
      let downloadUrl = '';

      if (season && episode) {
        // TV Series download
        downloadUrl = `https://dl.vidsrc.vip/tv/${imdb}/${season}/${episode}/${quality}`;
      } else {
        // Movie download
        downloadUrl = `https://dl.vidsrc.vip/movie/${imdb}/${quality}`;
      }

      // Try to trigger download
      try {
        const link = document.createElement('a');
        link.href = downloadUrl;
        link.download = `${title}_${quality}.mp4`;
        link.target = '_blank';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        // Show success message
        alert(`Download started for ${quality} quality. If download doesn't start automatically, the link will open in a new tab.`);
      } catch (error) {
        // Fallback - open in new window
        window.open(downloadUrl, '_blank');
        alert(`Download link opened in new tab for ${quality} quality.`);
      }

      hideDownloadOptions();
    }

    // Close download modal when clicking outside
    document.addEventListener('click', function(event) {
      const modal = document.getElementById('download-modal');
      const downloadBtn = document.querySelector('.download-btn');

      if (modal && modal.style.display === 'block' &&
          !modal.contains(event.target) &&
          !downloadBtn.contains(event.target)) {
        hideDownloadOptions();
      }
    });

    function refreshPlayer() {
      const iframe = document.getElementById('iframe');
      if (!iframe.src) {
        alert('Please select a movie or show first');
        return;
      }

      const currentSrc = iframe.src;
      iframe.src = '';
      setTimeout(() => {
        iframe.src = currentSrc;
      }, 100);

      // Visual feedback
      const refreshBtn = document.querySelector('.refresh-btn');
      refreshBtn.classList.add('active');
      setTimeout(() => {
        refreshBtn.classList.remove('active');
      }, 500);
    }

    function toggleFullscreen() {
      const playerContainer = document.querySelector('.player-container');
      const iframe = document.getElementById('iframe');

      if (!iframe.src) {
        alert('Please select a movie or show first');
        return;
      }

      if (!document.fullscreenElement) {
        // Enter fullscreen
        if (playerContainer.requestFullscreen) {
          playerContainer.requestFullscreen();
        } else if (playerContainer.webkitRequestFullscreen) {
          playerContainer.webkitRequestFullscreen();
        } else if (playerContainer.msRequestFullscreen) {
          playerContainer.msRequestFullscreen();
        }

        // Adjust iframe for fullscreen
        iframe.style.height = '100vh';
        iframe.style.borderRadius = '0';
      } else {
        // Exit fullscreen
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
      }

      // Visual feedback
      const fullscreenBtn = document.querySelector('.fullscreen-btn');
      fullscreenBtn.classList.add('active');
      setTimeout(() => {
        fullscreenBtn.classList.remove('active');
      }, 500);
    }

    // Handle fullscreen change
    document.addEventListener('fullscreenchange', function() {
      const iframe = document.getElementById('iframe');
      if (!document.fullscreenElement) {
        iframe.style.height = '340px';
        iframe.style.borderRadius = '12px';
      }
    });

    document.addEventListener('webkitfullscreenchange', function() {
      const iframe = document.getElementById('iframe');
      if (!document.webkitFullscreenElement) {
        iframe.style.height = '340px';
        iframe.style.borderRadius = '12px';
      }
    });

    // Store video data for server switching
    function storeVideoData(vidsrcUrl, embedUrl) {
      currentVideoData = {
        vidsrcUrl: vidsrcUrl,
        embedUrl: embedUrl
      };

      // Reset server button text
      const serverBtn = document.querySelector('.server-btn');
      if (serverBtn) {
        serverBtn.textContent = 'VidSrc';
      }
    }

    // Prevent any auto-scroll to top on SPA navigation or search
    window.scrollTo = function(){};
    // If any code tries to scroll to top, this disables it globally
    // If you want to allow smooth scroll to anchors, remove this override
  </script>
</body>
</html>
